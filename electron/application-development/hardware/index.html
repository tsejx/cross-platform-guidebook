<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/cross-platform-guidebook/umi.fb314de1.css" />
    <script>
      window.routerBase = "/cross-platform-guidebook/";
    </script>
    <script>
      //! umi version: 3.5.17
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.indexOf(e) > -1 ? e : r[0]
        );
      })();
    </script>
    <title>硬件管理</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/electron/application-development/hardware" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/cross-platform-guidebook-favicon.svg&#x27;)" href="/cross-platform-guidebook//">Cross Platform Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/cross-platform-guidebook//hybird">Hybrid</a></span><span><a href="/cross-platform-guidebook//mini-program">小程序</a></span><span><a href="/cross-platform-guidebook//react-native">ReactNative</a></span><span><a href="/cross-platform-guidebook//flutter">Flutter</a></span><span><a aria-current="page" class="active" href="/cross-platform-guidebook//electron">Electron</a></span><span><a href="/cross-platform-guidebook//pwa">PWA</a></span><span><a href="/cross-platform-guidebook//open-source">扩展</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/cross-platform-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/cross-platform-guidebook-favicon.svg&#x27;)" href="/cross-platform-guidebook//"></a><h1>Cross Platform Guidebook</h1><p>跨平台开发完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/cross-platform-guidebook//hybird">Hybrid</a></li><li><a href="/cross-platform-guidebook//mini-program">小程序</a></li><li><a href="/cross-platform-guidebook//react-native">ReactNative</a></li><li><a href="/cross-platform-guidebook//flutter">Flutter</a></li><li><a aria-current="page" class="active" href="/cross-platform-guidebook//electron">Electron</a></li><li><a href="/cross-platform-guidebook//pwa">PWA</a></li><li><a href="/cross-platform-guidebook//open-source">扩展</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/cross-platform-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/cross-platform-guidebook//electron">Electron</a></li><li><a aria-current="page" class="active" href="/cross-platform-guidebook//electron/application-development">应用开发</a><ul><li><a href="/cross-platform-guidebook//electron/application-development/main-process"><span>主进程模块</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/render-process"><span>渲染进程模块</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/window"><span>窗口管理</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/interface"><span>界面管理</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/data"><span>数据管理</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/system"><span>系统管理</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/communication"><span>通信管理</span></a></li><li><a aria-current="page" class="active" href="/cross-platform-guidebook//electron/application-development/hardware"><span>硬件管理</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/debug"><span>调试测试</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/security"><span>安全管理</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/release"><span>发布管理</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/compile"><span>编译打包</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/deploy"><span>应用部署</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/launch-and-exit"><span>生命周期</span></a></li><li><a href="/cross-platform-guidebook//electron/application-development/auto-update"><span>自动更新</span></a></li></ul></li><li><a href="/cross-platform-guidebook//electron/other">拓展资料</a><ul><li><a href="/cross-platform-guidebook//electron/other/community"><span>社区精选资源</span></a></li><li><a href="/cross-platform-guidebook//electron/other/compose"><span>桌面端技术选型分析</span></a></li><li><a href="/cross-platform-guidebook//electron/other/persistence"><span>数据持久化技术选型分析</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="屏幕" data-depth="2"><a href="/cross-platform-guidebook//electron/application-development/hardware#屏幕"><span>屏幕</span></a></li><li title="音视频设备" data-depth="2"><a href="/cross-platform-guidebook//electron/application-development/hardware#音视频设备"><span>音视频设备</span></a></li><li title="录屏" data-depth="2"><a href="/cross-platform-guidebook//electron/application-development/hardware#录屏"><span>录屏</span></a></li><li title="电源" data-depth="2"><a href="/cross-platform-guidebook//electron/application-development/hardware#电源"><span>电源</span></a></li><li title="电源的基本状态和事件" data-depth="3"><a href="/cross-platform-guidebook//electron/application-development/hardware#电源的基本状态和事件"><span>电源的基本状态和事件</span></a></li><li title="监控系统挂起与锁屏事件" data-depth="3"><a href="/cross-platform-guidebook//electron/application-development/hardware#监控系统挂起与锁屏事件"><span>监控系统挂起与锁屏事件</span></a></li><li title="阻止系统锁屏" data-depth="3"><a href="/cross-platform-guidebook//electron/application-development/hardware#阻止系统锁屏"><span>阻止系统锁屏</span></a></li><li title="打印机" data-depth="2"><a href="/cross-platform-guidebook//electron/application-development/hardware#打印机"><span>打印机</span></a></li><li title="导出 PDF" data-depth="3"><a href="/cross-platform-guidebook//electron/application-development/hardware#导出-pdf"><span>导出 PDF</span></a></li><li title="硬件信息" data-depth="2"><a href="/cross-platform-guidebook//electron/application-development/hardware#硬件信息"><span>硬件信息</span></a></li><li title="使用硬件串号控制应用分发" data-depth="3"><a href="/cross-platform-guidebook//electron/application-development/hardware#使用硬件串号控制应用分发"><span>使用硬件串号控制应用分发</span></a></li><li title="参考资料" data-depth="2"><a href="/cross-platform-guidebook//electron/application-development/hardware#参考资料"><span>参考资料</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="硬件管理"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#硬件管理"><span class="icon icon-link"></span></a>硬件管理</h1><p>以前 Web 前端技术是没办法访问客户端的硬件设备的，后来 HTML5 提供了一系列的技术来支持这项不足，但是限制太多了，一旦尝试使用这些特性，浏览器就会弹窗，用户同意后才能访问硬件。Electron 可以自由的使用这些特性，并且默认拥有了这些硬件的访问权限，甚至还提供了额外的支持以帮助开发者使用硬件的能力。</p><h2 id="屏幕"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#屏幕"><span class="icon icon-link"></span></a>屏幕</h2><p>用户电脑可能外界了多个显示器，那么你的窗口想显示在哪个显示器？首先你得获取到这些显示器：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> remote </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;electron&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">remote</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 获取主显示器</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> mainScreen </span><span class="token operator">=</span><span class="token plain"> remote</span><span class="token punctuation">.</span><span class="token property-access">screen</span><span class="token punctuation">.</span><span class="token method function property-access">getPrimaryDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">mainScreen</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p><code>mainScreen</code> 是一个对象，包含字段：</p><ul><li><code>id</code>：显示器 ID</li><li><code>rotation</code>：显示器是否选择，值可能是 0、90、180、270</li><li><code>touchSupport</code>：是否支持触屏</li><li><code>bounds</code>：绑定区域，可根据此判断是否为外界显示器</li><li><code>size</code>：显示器大小，与显示器分辨率有关，但不一定是显示器的分辨率</li></ul><p>将窗口显示到外界显示器上去</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> screen </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;electron&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> displays </span><span class="token operator">=</span><span class="token plain"> screen</span><span class="token punctuation">.</span><span class="token method function property-access">getAllDisplays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> externalDisplay </span><span class="token operator">=</span><span class="token plain"> displays</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token parameter">display</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> display</span><span class="token punctuation">.</span><span class="token property-access">bounds</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> display</span><span class="token punctuation">.</span><span class="token property-access">bounds</span><span class="token punctuation">.</span><span class="token property-access">y</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 判断是否外接扩展示器，如果 bounds.x 和 bounds.y 不等于 0 则为外接显示器</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 然后将窗口显示在外接显示器的左上角</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">externalDisplay</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  win </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    x</span><span class="token operator">:</span><span class="token plain"> externalDisplay</span><span class="token punctuation">.</span><span class="token property-access">bounds</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">50</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    y</span><span class="token operator">:</span><span class="token plain"> externalDisplay</span><span class="token punctuation">.</span><span class="token property-access">bounds</span><span class="token punctuation">.</span><span class="token property-access">y</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">50</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    webPreferences</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      nodeIntegration</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  win</span><span class="token punctuation">.</span><span class="token method function property-access">loadURL</span><span class="token punctuation">(</span><span class="token string">&#x27;https://www.baidu.com&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>另外，显示器信息对象包含 <code>internal</code> 属性，官方说明此属性值为 <code>true</code> 是内置显示器，<code>false</code> 为外接显示器。但实际开发时发现这个目前有 bug，无论是内置还是外接都显示为 <code>false</code>，因此通过 <code>display.bounds</code> 来确定是否外界显示器更准确。</p><p>注意：<code>screen</code> 模块只有在 <code>app.ready</code> 事件之后才能使用。</p><h2 id="音视频设备"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#音视频设备"><span class="icon icon-link"></span></a>音视频设备</h2><p>在开发 Web 网页应用时，如果要使用用户的音视频设备，浏览器为了安全，会向用户发出提示。用户允许浏览器访问其音视频设备后，前端代码才有权访问这些设备。而 Electron 不必获得用户授权，直接具有访问用户音视频设备的能力。</p><p>打开摄像头和麦克风获取用户音视频流</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> options </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  audio</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  video</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 获取摄像头和麦克风产生的流数据</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> mediaStream </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> </span><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">mediaDevices</span><span class="token punctuation">.</span><span class="token method function property-access">getUserMedia</span><span class="token punctuation">(</span><span class="token plain">option</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> video </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;video&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">video</span><span class="token punctuation">.</span><span class="token property-access">srcObject</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mediaStream</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">video</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onloadedmetadata</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  video</span><span class="token punctuation">.</span><span class="token method function property-access">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>在示例代码中，我们使用 <code>navigator.mediaDevices.getUserMedia</code> 来获取用户的音视频流，该方法需要一个配置参数，包含两个属性 <code>audio</code> 和 <code>video</code>。详细的参数请查看 <a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints">MediaStreamConstraints<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints">MediaTrackConstraints<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><p>如果设备有多个摄像头并且不区分前后，可以通过以下方法获取所有与摄像头基本信息：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> devices </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> </span><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">mediaDevices</span><span class="token punctuation">.</span><span class="token method function property-access">enumerateDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h2 id="录屏"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#录屏"><span class="icon icon-link"></span></a>录屏</h2><p>通过 <a target="_blank" rel="noopener noreferrer" href="https://www.electronjs.org/docs/api/desktop-capturer">desktopCapturer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 模块提供的 API 可用获取桌面的屏幕视频流，并且可以指定只获取某个应用的录屏，例如获取微信窗口的视频流显示在窗体内：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> desktopCapture </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;electron&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 获取桌面所有应用</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> sources </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> desktopCapture</span><span class="token punctuation">.</span><span class="token method function property-access">getSources</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  types</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;window&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;screen&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 找到微信</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> target </span><span class="token operator">=</span><span class="token plain"> sources</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> v</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;微信&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> mediaStream </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> </span><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">mediaDevices</span><span class="token punctuation">.</span><span class="token method function property-access">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  audio</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  video</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    mandatory</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      chromeMediaSource</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;desktop&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      chromeMediaSourceId</span><span class="token operator">:</span><span class="token plain"> target</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> video </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;video&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">video</span><span class="token punctuation">.</span><span class="token property-access">srcObject</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mediaStream</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">video</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onloadedmetadata</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  vido</span><span class="token punctuation">.</span><span class="token method function property-access">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>其中 <code>desktopCapture.getSources</code> 获取所有显示在桌面上的应用信息，获取到指定应用后，我们把应用的 ID 传递给 <code>video.mandatory.chromeMediaSourceId</code>，同时设置了 <code>video.mandatory.chromeMediaSource</code> 的值为 <code>desktop</code>。此后我们得到的视频流对象就与从摄像头里得到的视频流对象基本一致了。</p><h2 id="电源"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#电源"><span class="icon icon-link"></span></a>电源</h2><h3 id="电源的基本状态和事件"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#电源的基本状态和事件"><span class="icon icon-link"></span></a>电源的基本状态和事件</h3><p>获取电源状态</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> battery </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> </span><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">getBattery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><table><thead><tr><th align="left">属性名称</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>battery.charging</code></td><td align="left">是否正在充电，只要在充电，哪怕是满电状态也返回 <code>true</code></td></tr><tr><td align="left"><code>battery.chargingTime</code></td><td align="left">距离电池充满还剩多少时间，单位秒，如果为 0 则代表充满了</td></tr><tr><td align="left"><code>battery.dischargingTime</code></td><td align="left">电池电量还能用多久，单位秒，如果电池满电并且还在冲，值位 infinity 无穷大</td></tr><tr><td align="left"><code>battery.level</code></td><td align="left">充电水平，值范围在 0 到 1 之间</td></tr></tbody></table><p>Battery 实例的事件：</p><table><thead><tr><th align="left">事件名称</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>battery.onchargingchange</code></td><td align="left">接入和断开交流电时触发该事件</td></tr><tr><td align="left"><code>battery.onchargingtimechange</code></td><td align="left">当 chargingTime 属性发生变化时触发</td></tr><tr><td align="left"><code>battery.ondischargingtimechange</code></td><td align="left">当 dischargingTime 属性变化时触发</td></tr><tr><td align="left"><code>battery.onlevelchange</code></td><td align="left">当 level 属性变化时触发</td></tr></tbody></table><h3 id="监控系统挂起与锁屏事件"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#监控系统挂起与锁屏事件"><span class="icon icon-link"></span></a>监控系统挂起与锁屏事件</h3><p>上面的电源 API 是 HTML5 中为网页提供的，在 Electron 中不需要用户授权就能访问。除了 HTML5 API 的能力外，Electron 自己也封装了对电源的 <a target="_blank" rel="noopener noreferrer" href="https://www.electronjs.org/docs/api/power-monitor">powerMonitor<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 模块，并且把监控系统是否挂起和恢复事件、系统空闲状态获取的能力也放在了这个模块中。</p><h4 id="监视系统挂起和恢复事件"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#监视系统挂起和恢复事件"><span class="icon icon-link"></span></a>监视系统挂起和恢复事件</h4><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> powerMonitor </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;electron&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">remote</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">powerMonitor</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;suspend&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;系统睡眠了&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">powerMonitor</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;resume&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;系统唤醒了&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h4 id="监听系统锁屏和解锁事件"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#监听系统锁屏和解锁事件"><span class="icon icon-link"></span></a>监听系统锁屏和解锁事件</h4><p>目前只适用于 win 和 mac，linux 下不行：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">powerMonitor</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;lock-screen&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;锁屏了&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">powerMonitor</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;unlock-screen&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;解锁了&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>系统挂起（睡眠）后，系统内一些应用会切换到挂起状态，不再提供服务，如果 Electron 应用依赖这些服务就会出现问题，因此可以通过这四个事件做一些挂起前后的处理防止业务异常。</p><h3 id="阻止系统锁屏"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#阻止系统锁屏"><span class="icon icon-link"></span></a>阻止系统锁屏</h3><p>操作系统在一段事件没有收到用户操作时会进入省电模式，关闭显示器，把内存中的内容转存到磁盘，进入睡眠模式。如果做的是个播放器这种应用，在播放视频的时候就需要防止系统息屏、睡眠。操作系统提供了<a target="_blank" rel="noopener noreferrer" href="https://www.electronjs.org/docs/api/power-save-blocker">powerSaveBlocker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> API，Electron 对其有实现：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> powerSaveBlocker </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;electron&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> id </span><span class="token operator">=</span><span class="token plain"> powerSaveBlocker</span><span class="token punctuation">.</span><span class="token method function property-access">start</span><span class="token punctuation">(</span><span class="token string">&#x27;prevent-display-sleep&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 判断阻止行为是否已启动</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">powerSaveBlocker</span><span class="token punctuation">.</span><span class="token method function property-access">isStarted</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">powerSaveBlocker</span><span class="token punctuation">.</span><span class="token method function property-access">stop</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><table><thead><tr><th align="left">事件名称</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>prevent-display-sleep</code></td><td align="left">防止系统锁屏</td></tr><tr><td align="left"><code>prevent-app-suspension</code></td><td align="left">防止程序挂起（程序在下载文件或播放音乐时需要阻止音乐挂起）</td></tr></tbody></table><p><code>start()</code> 方法返回一个整型 <code>id</code>，如果要解除阻止可以通过 <code>stop()</code> 传入 <code>id</code> 来解除：</p><h2 id="打印机"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#打印机"><span class="icon icon-link"></span></a>打印机</h2><p>打印当前窗体中的页面</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> remote </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;electron&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> webContents </span><span class="token operator">=</span><span class="token plain"> remote</span><span class="token punctuation">.</span><span class="token method function property-access">getCureentWebContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">webContents</span><span class="token punctuation">.</span><span class="token method function property-access">print</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    slient</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    printBackground</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    deviceName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 打印完成后的回调函数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 打印完成则 success 为 true，如果打印失败或者用户取消则返回 false</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token parameter">success</span><span class="token parameter punctuation">,</span><span class="token parameter"> error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">success</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>执行如上代码会弹出打印机选择框，选择打印机才能打印，如果要设置指定打印机，那么应该先获得当前电脑所有打印机，然后用户选择一个默认打印机。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> remote </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;electron&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> content </span><span class="token operator">=</span><span class="token plain"> remote</span><span class="token punctuation">.</span><span class="token method function property-access">getCurrentWebContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> printers </span><span class="token operator">=</span><span class="token plain"> content</span><span class="token punctuation">.</span><span class="token method function property-access">getPrinters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">printers</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 输出打印机名称</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 那这个打印机名称传递到上面 print() 方法的 deviceName 即可</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="导出-pdf"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#导出-pdf"><span class="icon icon-link"></span></a>导出 PDF</h3><p>可以通过打印能力把页面导出为 PDF 文件</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> remote </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;electron&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> path </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">requrie</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> fs </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;fs&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> webContents </span><span class="token operator">=</span><span class="token plain"> remote</span><span class="token punctuation">.</span><span class="token method function property-access">getCurrentWebContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> data </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> webContents</span><span class="token punctuation">.</span><span class="token method function property-access">printToPDF</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> filePath </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token plain">__static</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;xxx.pdf&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">fs</span><span class="token punctuation">.</span><span class="token method function property-access">writeFile</span><span class="token punctuation">(</span><span class="token plain">filePath</span><span class="token punctuation">,</span><span class="token plain"> data</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword control-flow">throw</span><span class="token plain"> error</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;PDF导出成功&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p><code>webContents.printToPDF()</code> 方法可接受的参数配置项与前面 <code>print()</code> 方法是一样的，这里不再重复演示。<code>printToPDF()</code> 方法返回一个 Promise 对象，内容是 Buffer 缓存，可以把这个 Buffer 保存到指定文件路径，也可以打开保存文件对话框让用户选择保存文件的路径，现在我们把上面 <code>fs.writeFile()</code> 方法改造一下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> savePath </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> remote</span><span class="token punctuation">.</span><span class="token property-access">dialog</span><span class="token punctuation">.</span><span class="token method function property-access">showSaveDialog</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;保存PDF&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  filters</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;xxx&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      extensions</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;pdf&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">savePath</span><span class="token punctuation">.</span><span class="token property-access">canceled</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 用户在对话框点击取消了，则不保存</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 进行保存</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">fs</span><span class="token punctuation">.</span><span class="token method function property-access">writeFile</span><span class="token punctuation">(</span><span class="token plain">savePath</span><span class="token punctuation">.</span><span class="token property-access">filePath</span><span class="token punctuation">,</span><span class="token plain"> data</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword control-flow">throw</span><span class="token plain"> error</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h2 id="硬件信息"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#硬件信息"><span class="icon icon-link"></span></a>硬件信息</h2><p><a target="_blank" rel="noopener noreferrer" href="https://www.electronjs.org/docs/api/process">Electron Process API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>获取内存使用情况</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> memoryUsage </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation">.</span><span class="token method function property-access">getSystemMemoryInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">memoryUsage</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><table><thead><tr><th align="left">属性名称</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>total</code></td><td align="left">当前系统可用的物理内存总量</td></tr><tr><td align="left"><code>free</code></td><td align="left">应用程序或磁盘缓存未使用的内存总量</td></tr><tr><td align="left"><code>swapTotal</code></td><td align="left">系统交换内存总量</td></tr><tr><td align="left"><code>swapFree</code></td><td align="left">系统可用交换内存总量</td></tr></tbody></table><p>获取 CPU 使用情况</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> cpuUsage </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation">.</span><span class="token method function property-access">getCPUUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">cpuUsage</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1600</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>打印出来 <a target="_blank" rel="noopener noreferrer" href="https://www.electronjs.org/docs/api/structures/cpu-usage">CPUUsage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 对象，有两个属性：</p><ul><li><code>percentCPUUsage</code>：某个时间段内 CPU 使用率</li><li><code>idleWakeupsPerSecond</code>：某个时间段内每秒唤醒空闲 CPU 的平均次数，此值在 Windows 下永远返回 0</li></ul><p>第一次调用 <code>process.getCPUUsage()</code> 时这两个值都是 0，后面每次调用获得值为本次调用与上次调用之间这段时间内相应 CPU 使用率和唤醒空闲 CPU 的平均次数，所以上面代码要用定时器来不断请求 CPUUsage 对象。</p><p>Electron 提供的硬件信息 API 太简单了，如果需要获得更详细的硬件信息可以使用 <a target="_blank" rel="noopener noreferrer" href="https://github.com/sebhildebrandt/systeminformation">systeminformantion<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 这个库。</p><h3 id="使用硬件串号控制应用分发"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#使用硬件串号控制应用分发"><span class="icon icon-link"></span></a>使用硬件串号控制应用分发</h3><p>开发商业桌面 GUI 应用，有时候需要控制应用分发的范围，比如用户购买某软件的使用权后，应用开发商只允许用户在某一台固定的物理设备上使用该软件，不允许用户随意地在其他设备上安装并使用。如果用户希望在另一台设备上可以使用，则需要另外购买使用权。</p><p>如果开发者想让自己开发的软件具备这种能力，一种常见的办法是获取用户设备的专有硬件信息，并把这个信息与当前使用该软件的用户信息、用户的付费情况信息绑定，保存在一个服务器上。当用户打开软件时，软件获取这个物理设备的专有硬件信息，并把这个信息连同当前用户信息发送到服务端，由服务端确认该用户是否已为该设备购买了授权，如果没有则通知应用，要求用户付费。</p><p>这种方式有两个弊端，一是由于验证过程强依赖于服务端，所以这个应用必须联网，对于一些有离线使用需求的应用来说，这个方案显然行不通。除此之外，一些恶意用户完全可以自己开发一个简单的服务，代理这个验证授权的请求，这个简单的服务只要永远返回验证授权通过的结果就能让恶意用户免费使用该软件。</p><p>对于离线应用来说，开发者可以通过一个安全的算法来保证应用只被安装在一台设备上，具体实现过程为：当应用第一次启动时，应用获取到这个物理设备的专有硬件信息，并把这个信息发送到服务端，用户付费后，服务端通过算法生成一个与该硬件信息匹配的激活码，并把这个激活码发送给用户，由用户把激活码保存在应用内。以后用户每次启动时，应用通过同样算法验证激活码是否与当前设备的硬件信息匹配，如果匹配则授权成功，反之授权失败。</p><p>每次执行逻辑的关键点是服务端根据用户设备的专有硬件信息生成激活码的过程，和应用每次启动时检验激活码与硬件信息是否匹配的过程。这两个过程内的算法是要严格保密的，一旦被恶意用户窃取（或通过逆向工程分析出了算法逻辑），那么恶意用户就可以开发一个注册机来无限生成激活码，无限制地分发你的软件。</p><p>使用 <a target="_blank" rel="noopener noreferrer" href="https://github.com/sebhildebrandt/systeminformation">systeminformation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 获取当前硬件中各个组件的串号，并依据这些串号的组合来保证硬件专有信息唯一：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 返回当前物理设备的所有组件的静态信息，包括内存、CPU、磁盘网卡等组件的生产厂家、型号、硬件串号等信息</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> staticData </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> si</span><span class="token punctuation">.</span><span class="token method function property-access">getStaticData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> serial </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 系统串号</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  systemSerial</span><span class="token operator">:</span><span class="token plain"> staticData</span><span class="token punctuation">.</span><span class="token property-access">system</span><span class="token punctuation">.</span><span class="token property-access">serial</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 主板串号</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  baseboardSerial</span><span class="token operator">:</span><span class="token plain"> staticData</span><span class="token punctuation">.</span><span class="token property-access">baseboard</span><span class="token punctuation">.</span><span class="token property-access">serial</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 基座串号</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  chassisSerial</span><span class="token operator">:</span><span class="token plain"> staticData</span><span class="token punctuation">.</span><span class="token property-access">chassis</span><span class="token punctuation">.</span><span class="token property-access">serial</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 第一块磁盘的串号</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  diskSerial</span><span class="token operator">:</span><span class="token plain"> staticData</span><span class="token punctuation">.</span><span class="token property-access">diskLayout</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">serialNum</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 第一个内存的串号</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  memSerial</span><span class="token operator">:</span><span class="token plain"> staticData</span><span class="token punctuation">.</span><span class="token property-access">memLayout</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">serialNum</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> arr </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> si</span><span class="token punctuation">.</span><span class="token method function property-access">networkInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> networkInterfaceDefault </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> si</span><span class="token punctuation">.</span><span class="token method function property-access">networkInterfaceDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">item</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> arr</span><span class="token punctuation">.</span><span class="token method function property-access">flter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> v</span><span class="token punctuation">.</span><span class="token property-access">iface</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> networkInterfaceDefault</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 默认网卡的 MAC 地址</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">serial</span><span class="token punctuation">.</span><span class="token property-access">mac</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> item</span><span class="token punctuation">.</span><span class="token property-access">mac</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 开发者可以依据此字符串，保证当前设备是唯一的</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> serialNumStr </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token plain">serial</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">srialNumStr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>通过上述代码得到的硬件串号字符串最好不要直接使用，而是通过哈希运算获得哈希值。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> crypto </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;crypto&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> serialHash </span><span class="token operator">=</span><span class="token plain"> crypto</span><span class="token punctuation">.</span><span class="token method function property-access">createHash</span><span class="token punctuation">(</span><span class="token string">&#x27;sha256&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token plain">serialNumStr</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">digest</span><span class="token punctuation">(</span><span class="token string">&#x27;hex&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">serialHash</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h2 id="参考资料"><a aria-hidden="true" tabindex="-1" href="/cross-platform-guidebook//electron/application-development/hardware#参考资料"><span class="icon icon-link"></span></a>参考资料</h2><ul><li><a target="_blank" rel="noopener noreferrer" href="https://www.electronjs.org/docs/api/screen">Electron Docs: screen API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.electronjs.org/docs/api/desktop-capturer">Electron Docs: desktopCapturer API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.electronjs.org/docs/api/power-monitor">Electron Docs: powerMonitor API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.electronjs.org/docs/api/power-save-blocker">Electron Docs: powerSaveBlocker API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://w3c.github.io/mediacapture-main/#dom-mediatrackconstraints">W3C: Media Capture and Streams<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/cross-platform-guidebook/edit/master/docs/electron/application-development/hardware.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">8/23/2021 10:31:17</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/cross-platform-guidebook/umi.7173b769.js"></script>
  </body>
</html>
